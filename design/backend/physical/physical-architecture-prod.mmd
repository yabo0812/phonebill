%%{init: {'theme':'base', 'themeVariables': { 'primaryColor': '#ffffff', 'primaryTextColor': '#000000', 'primaryBorderColor': '#000000', 'lineColor': '#000000'}}}%%

graph TB
    %% ì‚¬ìš©ì ë° ì™¸ë¶€ ì‹œìŠ¤í…œ
    subgraph "External Systems"
        User[ğŸ‘¤ MVNO ì‚¬ìš©ì<br/>Peak 1,000 ë™ì‹œì‚¬ìš©ì]
        KOS[ğŸ¢ KOS-Order System<br/>í†µì‹ ì‚¬ ë°±ì—”ë“œ<br/>On-premises]
    end
    
    %% Azure Front Door
    subgraph "Azure Edge"
        AFD[ğŸŒ Azure Front Door<br/>+ CDN<br/>Global Load Balancer<br/>DDoS Protection]
    end
    
    %% Azure Virtual Network
    subgraph "Azure Virtual Network (10.0.0.0/16)"
        
        %% Application Gateway Subnet
        subgraph "Gateway Subnet (10.0.4.0/24)"
            AppGW[ğŸ›¡ï¸ Application Gateway<br/>Standard_v2<br/>Multi-Zone<br/>+ WAF (OWASP)]
        end
        
        %% AKS Cluster
        subgraph "Application Subnet (10.0.1.0/24)"
            subgraph "AKS Premium Cluster"
                subgraph "System Node Pool"
                    SysNodes[âš™ï¸ System Nodes<br/>D2s_v3 Ã— 3-5<br/>Multi-Zone]
                end
                
                subgraph "Application Node Pool"
                    AppNodes[ğŸ–¥ï¸ App Nodes<br/>D4s_v3 Ã— 3-10<br/>Multi-Zone<br/>Auto-scaling]
                    
                    subgraph "Microservices Pods"
                        AuthPod[ğŸ” Auth Service<br/>Replicas: 3-10<br/>200m CPU, 512Mi RAM]
                        BillPod[ğŸ“Š Bill-Inquiry Service<br/>Replicas: 3-15<br/>500m CPU, 1Gi RAM]
                        ProductPod[ğŸ”„ Product-Change Service<br/>Replicas: 2-8<br/>300m CPU, 768Mi RAM]
                        KOSMockPod[ğŸ”§ KOS-Mock Service<br/>Replicas: 2-4<br/>200m CPU, 512Mi RAM]
                    end
                end
            end
            
        end
        
        %% Database Subnet
        subgraph "Database Subnet (10.0.2.0/24)"
            PG[ğŸ—ƒï¸ Azure PostgreSQL<br/>Flexible Server<br/>GeneralPurpose D4s_v3<br/>Zone Redundant HA<br/>256GB Premium SSD<br/>35ì¼ ë°±ì—…]
            
            ReadReplica[ğŸ“š Read Replicas<br/>D2s_v3<br/>Korea South + Central<br/>ì½ê¸° ë¶€í•˜ ë¶„ì‚°]
        end
        
        %% Cache Subnet
        subgraph "Cache Subnet (10.0.3.0/24)"
            Redis[âš¡ Azure Redis Cache<br/>Premium P2 (6GB)<br/>í´ëŸ¬ìŠ¤í„°ë§ + ë³µì œ<br/>Zone Redundant<br/>Private Endpoint]
        end
    end
    
    %% Azure ê´€ë¦¬í˜• ì„œë¹„ìŠ¤
    subgraph "Azure Managed Services"
        KeyVault[ğŸ”‘ Azure Key Vault<br/>Premium HSM<br/>ì•”í˜¸í™”í‚¤ ê´€ë¦¬<br/>Private Endpoint]
        
        Monitor[ğŸ“Š Azure Monitor<br/>Log Analytics<br/>Application Insights<br/>Container Insights]
        
        ACR[ğŸ“¦ Container Registry<br/>Premium Tier<br/>Geo-replication<br/>ë³´ì•ˆ ìŠ¤ìº”]
    end
    
    %% íŠ¸ë˜í”½ íë¦„
    User --> AFD
    AFD --> AppGW
    AppGW --> AuthPod
    AppGW --> BillPod
    AppGW --> ProductPod
    AppGW --> KOSMockPod
    
    %% ì„œë¹„ìŠ¤ ê°„ í†µì‹ 
    AuthPod --> PG
    BillPod --> PG
    ProductPod --> PG
    KOSMockPod --> PG
    
    AuthPod --> Redis
    BillPod --> Redis
    ProductPod --> Redis
    
    %% KOS-Mock ì—°ë™ (ì™¸ë¶€ KOS ì‹œìŠ¤í…œ ëŒ€ì²´)
    BillPod --> KOSMockPod
    ProductPod --> KOSMockPod
    
    %% ë°ì´í„°ë² ì´ìŠ¤ ë³µì œ
    PG --> ReadReplica
    
    %% ë³´ì•ˆ ë° í‚¤ ê´€ë¦¬
    AuthPod --> KeyVault
    BillPod --> KeyVault
    ProductPod --> KeyVault
    KOSMockPod --> KeyVault
    
    %% ëª¨ë‹ˆí„°ë§
    AppNodes --> Monitor
    PG --> Monitor
    Redis --> Monitor
    
    %% ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€
    AppNodes --> ACR
    
    %% ìŠ¤íƒ€ì¼ë§
    classDef userClass fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef azureClass fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef appClass fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef dataClass fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef securityClass fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    
    class User,KOS userClass
    class AFD,AppGW,SysNodes,AppNodes azureClass
    class AuthPod,BillPod,ProductPod,KOSMockPod appClass
    class PG,Redis,ReadReplica dataClass
    class KeyVault,Monitor,ACR securityClass